<% content_for :title, @journal.title %>

<div class="min-h-screen bg-gray-50">
  <!-- Header Section -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 py-8">
      <!-- Navigation Breadcrumb -->
      <div class="mb-6">
        <%= link_to journals_path, class: "inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors duration-200" do %>
          <i class="fas fa-arrow-left mr-3"></i>
          <span class="text-lg font-medium">Back to Journals</span>
        <% end %>
      </div>

      <!-- Journal Title and Description -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4 leading-tight">
          <%= @journal.title %>
        </h1>
        <% if @journal.description.present? %>
          <p class="text-lg text-gray-600 leading-relaxed max-w-4xl">
            <%= @journal.description %>
          </p>
        <% end %>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-6 py-8">
    <% if current_user.learner? %>
      <!-- Progress Indicator -->
      <% if @journal.questions.any? %>
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold text-gray-900">Your Progress</h2>
            <span class="text-lg font-medium text-gray-600">
              <%= @submission&.completion_percentage || 0 %>% Complete
            </span>
          </div>
          <div class="mt-4 bg-gray-200 rounded-full h-3">
            <div class="bg-blue-600 h-3 rounded-full transition-all duration-300" 
                 style="width: <%= @submission&.completion_percentage || 0 %>%"></div>
          </div>
        </div>
      <% end %>

      <!-- Questions -->
      <% if @journal.questions.any? %>
        <%= form_with url: responses_path, local: false, id: "journal-responses-form", class: "space-y-8" do |form| %>
          <% @journal.questions.ordered.each_with_index do |question, index| %>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                  <span class="inline-flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full text-sm font-bold mr-4">
                    <%= index + 1 %>
                  </span>
                  <%= question.content %>
                  <% if question.required? %>
                    <span class="text-red-600 ml-2" title="Required">*</span>
                  <% end %>
                </h3>
                
                <% if question.description.present? %>
                  <div class="ml-12 mt-2 text-gray-600">
                    <%= question.description %>
                  </div>
                <% end %>
              </div>
              
              <div class="ml-12">
                <% response = @responses&.find { |r| r.question_id == question.id } %>
                <%= render partial: 'questions/form_field', locals: { question: question, response: response } %>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="text-center py-16">
          <i class="fas fa-question-circle text-6xl text-gray-300 mb-6"></i>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">No Questions Added Yet</h3>
          <p class="text-lg text-gray-500">This journal is being prepared. Please check back soon.</p>
        </div>
      <% end %>

    <% else %>
      <!-- Instructor/Admin View -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Journal Management</h2>
        <!-- Add instructor view content here -->
      </div>
    <% end %>
  </main>
</div>