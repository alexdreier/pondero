<% content_for :title, @journal.title %>

<div class="bg-gray-50 min-h-screen">
  <!-- Simple Header -->
  <div class="bg-white border-b">
    <div class="max-w-4xl mx-auto px-6 py-6">
      <%= link_to journals_path, class: "text-blue-600 hover:text-blue-800" do %>
        ‚Üê Back to Journals
      <% end %>
      
      <h1 class="text-2xl font-bold text-gray-900 mt-4">
        <%= @journal.title %>
      </h1>
      
      <% if @journal.description.present? %>
        <p class="text-gray-600 mt-2">
          <%= @journal.description %>
        </p>
      <% end %>
    </div>
  </div>

  <!-- Simple Content -->
  <div class="max-w-4xl mx-auto px-6 py-6">
    <% if current_user.learner? && @journal.questions.any? %>
      <!-- Progress -->
      <div class="bg-white p-4 rounded border mb-6">
        <div class="flex justify-between items-center">
          <span class="font-medium">Progress:</span>
          <span><%= @submission&.completion_percentage || 0 %>%</span>
        </div>
        <div class="bg-gray-200 rounded h-2 mt-2">
          <div class="bg-blue-600 h-2 rounded" style="width: <%= @submission&.completion_percentage || 0 %>%"></div>
        </div>
      </div>

      <!-- Questions - SUPER SIMPLE -->
      <%= form_with url: responses_path, local: false do |form| %>
        <% @journal.questions.ordered.each_with_index do |question, index| %>
          <div class="bg-white p-6 rounded border mb-4">
            <div class="mb-4">
              <h3 class="text-lg font-semibold flex items-center">
                <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3">
                  <%= index + 1 %>
                </span>
                <%= question.content %>
                <% if question.required? %>
                  <span class="text-red-600 ml-2">*</span>
                <% end %>
              </h3>
              
              <% if question.description.present? %>
                <div class="ml-9 text-gray-600 text-sm">
                  <%= question.description %>
                </div>
              <% end %>
            </div>
            
            <div class="ml-9">
              <% response = @responses&.find { |r| r.question_id == question.id } %>
              <% case question.question_type %>
              <% when 'free_text' %>
                <textarea name="response[content]" placeholder="Enter your response..." 
                          class="w-full p-3 border rounded min-h-[100px]"><%= response&.content&.to_s&.strip %></textarea>
              
              <% when 'single_response' %>
                <textarea name="response[content]" placeholder="Enter your response..." 
                          class="w-full p-3 border rounded min-h-[100px]"><%= response&.content&.to_s&.strip %></textarea>
              
              <% when 'choice' %>
                <div class="space-y-2">
                  <% question.options_array.each do |option| %>
                    <label class="flex items-center">
                      <input type="radio" name="response[content]" value="<%= option %>" 
                             class="mr-2" <%= 'checked' if response&.content&.to_s == option %>>
                      <%= option %>
                    </label>
                  <% end %>
                </div>
              
              <% when 'multiple_response' %>
                <div class="space-y-2">
                  <% selected = (response&.content&.to_s&.split(',') || []) %>
                  <% question.options_array.each do |option| %>
                    <label class="flex items-center">
                      <input type="checkbox" name="response[content][]" value="<%= option %>" 
                             class="mr-2" <%= 'checked' if selected.include?(option) %>>
                      <%= option %>
                    </label>
                  <% end %>
                </div>
              
              <% when 'likert_scale' %>
                <div class="flex justify-between">
                  <% question.options_array.each do |option| %>
                    <label class="flex flex-col items-center">
                      <input type="radio" name="response[content]" value="<%= option %>" 
                             class="mb-1" <%= 'checked' if response&.content&.to_s == option %>>
                      <span class="text-xs text-center"><%= option %></span>
                    </label>
                  <% end %>
                </div>
              
              <% else %>
                <p class="text-gray-500">Question type: <%= question.question_type %></p>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <div class="text-center mt-6">
          <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
            Save Responses
          </button>
        </div>
      <% end %>
    
    <% elsif current_user.learner? %>
      <div class="text-center py-12">
        <p class="text-gray-600">No questions available yet.</p>
      </div>
    
    <% else %>
      <div class="bg-white p-6 rounded border">
        <h2 class="text-xl font-bold mb-4">Journal Management</h2>
        <p class="text-gray-600">Instructor/Admin view</p>
      </div>
    <% end %>
  </div>
</div>